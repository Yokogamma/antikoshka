(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function c(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(t){if(t.ep)return;t.ep=!0;const e=c(t);fetch(t.href,e)}})();const I=document.querySelector("#brandmenu"),E=document.querySelector(".brandmenu-dropdown");I.addEventListener("click",()=>{E.classList.toggle("show")});const k=document.getElementById("calc-form"),w=async n=>{n.preventDefault();const o=new FormData(k),c=Object.fromEntries(o.entries());console.log(c);const s="https://dim.komax.com.ua/api/calc/moskitos";try{const t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!t.ok)throw new Error(`Помилка мережі: ${t.status}`);const e=await t.json();console.log("Дані успішно отримано:"),console.log("Площа (square):",e.square),console.log("Ціна (price):",e.price);const r=document.getElementById("price-result");r.textContent=e.price.toString();const f=document.getElementById("square-result");f.textContent=e.square.toString(),document.getElementById("calc-results-block").classList.add("active");const i={};o.forEach((m,l)=>{i[l]=m.toString()});const d=i.city;["formData","moskitos_"+d,"moskitos_temp_"+d].forEach(m=>localStorage.removeItem(m)),localStorage.setItem("moskitos_temp_"+d,JSON.stringify(i)),typeof d=="string"&&localStorage.setItem("city",d),console.log("Сохранено в LocalStorage:",i)}catch(t){t instanceof Error?console.error("Виникла проблема із запитом:",t.message):console.error("Невідома помилка:",t)}};k.addEventListener("submit",w);function B(){const n=localStorage.getItem("city");if(n){const o=localStorage.getItem("moskitos_temp_"+n);if(o){const c=JSON.parse(o),s=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");s.push(c),localStorage.setItem("moskitos_setki_kyiv",JSON.stringify(s)),console.log("Обновлённый массив объектов:",s),g(),localStorage.setItem("windows_lastAdded",Date.now().toString()),document.getElementById("basket-block").classList.add("active")}}}const _=document.getElementById("addBasket");_?.addEventListener("click",()=>B());const b=document.getElementById("open-fill-order");b?.addEventListener("click",()=>L());function L(){document.getElementById("fill-order").classList.add("active")}function g(){const n=document.getElementById("list");if(!n)return;const o=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");n.innerHTML="",o.forEach((s,t)=>{const e=document.createElement("li");e.textContent=`${t+1}. ${s.city} — ${s.width}x${s.height} `;const r=document.createElement("button");r.textContent="Удалить",r.style.marginLeft="10px",r.addEventListener("click",()=>{O(t)}),e.appendChild(r),n.appendChild(e)});const c=localStorage.getItem("windows_lastAdded");if(c){const s=new Date(parseInt(c));console.log("Последнее добавление:",s.toLocaleString())}N()}function O(n){const o=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");o.splice(n,1),localStorage.setItem("moskitos_setki_kyiv",JSON.stringify(o)),g()}function N(){const n=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]"),o=document.getElementById("count"),c=document.getElementById("sumWidth"),s=n.length,t=n.reduce((e,r)=>e+Number(r.width||0),0);o&&(o.textContent=s.toString()),c&&(c.textContent=t.toString())}g();const u=document.getElementById("zakaz"),a=document.getElementById("orderResult");u.addEventListener("submit",async n=>{n.preventDefault();const o=new FormData(u),c=o.get("name")?.toString()||"",s=o.get("email")?.toString()||"",t=o.get("phone")?.toString()||"",r=u.querySelector('input[name="choice2"]:checked')?.value||"",p=u.querySelector('input[name="choice"]:checked')?.value||"",i=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]"),d=i.length,y=i.reduce((l,h)=>l+Number(h.width||0),0),m={name:c,email:s,phone:t,windows:i,count:d,sumWidth:y,payment:r,delivery:p};try{const l=await fetch("http://ava.test/api/zakaz/moskitos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});if(!l.ok)throw new Error("Ошибка отправки заказа");const S=(await l.json()).orderNumber;a&&(a.textContent=`Ваш номер заказа: ${S}`,u.reset(),localStorage.removeItem("moskitos_setki_kyiv"),document.querySelectorAll(".active").forEach(v=>{v.classList.remove("active")}),requestAnimationFrame(()=>{setTimeout(()=>{a&&(a.scrollIntoView({behavior:"smooth",block:"start"}),a.classList.add("highlight"),setTimeout(()=>a.classList.remove("highlight"),2e3))},500)}))}catch(l){console.error(l),a&&(a.textContent="Произошла ошибка при отправке заказа.")}});
