(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const x={type:{"Пластиковое окно":{type:{status:1,selected:0,options:{"Пластиковое окно":"Пластиковое","Деревянное окно":"Деревянное","Аллюминиевое окно":"Алюминиевое"}},antikoshka:{status:1,selected:0,options:{"Защитная антикошка":"Защитная (до 7кг котик)","Усиленная антикошка":"Усиленная (до 17 кг котик)"}},open:{status:1,selected:0,options:{"сетка не открывается":"Нет","сетка открывается":"Да"}}},"Деревянное окно":{type:{status:1,selected:1,options:{"Пластиковое окно":"Пластиковое","Деревянное окно":"Деревянное","Аллюминиевое окно":"Алюминиевое"}},antikoshka:{status:1,selected:0,options:{"Защитная антикошка":"Защитная (до 7кг котик)"}},open:{status:1,selected:0,options:{"сетка не открывается":"Нет"}}},"Аллюминиевое окно":{type:{status:1,selected:2,options:{"Пластиковое окно":"Пластиковое","Деревянное окно":"Деревянное","Аллюминиевое окно":"Алюминиевое"}},antikoshka:{status:1,selected:0,options:{"Защитная антикошка":"Защитная (до 7кг котик)"}},open:{status:1,selected:0,options:{"сетка не открывается":"Нет"}}}},antikoshka:{"Защитная антикошка":{type:{status:1,selected:0,options:{"Пластиковое окно":"Пластиковое","Деревянное окно":"Деревянное","Аллюминиевое окно":"Алюминиевое"}},antikoshka:{status:1,selected:0,options:{"Защитная антикошка":"Защитная (до 7кг котик)","Усиленная антикошка":"Усиленная (до 17 кг котик)"}},open:{status:1,selected:0,options:{"сетка не открывается":"Нет","сетка открывается":"Да"}}},"Усиленная антикошка":{type:{status:1,selected:0,options:{"Пластиковое окно":"Пластиковое"}},antikoshka:{status:1,selected:1,options:{"Защитная антикошка":"Защитная (до 7кг котик)","Усиленная антикошка":"Усиленная (до 17 кг котик)"}},open:{status:1,selected:0,options:{"сетка не открывается":"Нет"}}}},open:{"сетка не открывается":{type:{status:1,selected:0,options:{"Пластиковое окно":"Пластиковое","Деревянное окно":"Деревянное","Аллюминиевое окно":"Алюминиевое"}},antikoshka:{status:1,selected:0,options:{"Защитная антикошка":"Защитная (до 7кг котик)","Усиленная антикошка":"Усиленная (до 17 кг котик)"}},open:{status:1,selected:0,options:{"сетка не открывается":"Нет","сетка открывается":"Да"}}},"сетка открывается":{type:{status:1,selected:0,options:{"Пластиковое окно":"Пластиковое"}},antikoshka:{status:1,selected:0,options:{"Защитная антикошка":"Защитная (до 7кг котик)"}},open:{status:1,selected:1,options:{"сетка не открывается":"Нет","сетка открывается":"Да"}}}}};function _(o){const e=document.querySelector('select[name="type"]'),r=document.querySelector('select[name="antikoshka"]'),t=document.querySelector('select[name="open"]'),n=r.closest(".fieldset"),s=t.closest(".fieldset");function c(i,l,d){i.innerHTML="",Object.keys(l).forEach((m,k)=>{const g=document.createElement("option");g.value=m,g.textContent=l[m],k===d&&(g.selected=!0),i.appendChild(g)})}function a(i){e.disabled=i.type.status===0,e.closest(".fieldset").classList.toggle("hidden",i.type.status===0),c(e,i.type.options,i.type.selected),r.disabled=i.antikoshka.status===0,n.classList.toggle("hidden",i.antikoshka.status===0),c(r,i.antikoshka.options,i.antikoshka.selected),t.disabled=i.open.status===0,s.classList.toggle("hidden",i.open.status===0),c(t,i.open.options,i.open.selected)}function p(i,l){return o[i][l]??o.type["Пластиковое окно"]}e.addEventListener("change",()=>a(p("type",e.value))),r.addEventListener("change",()=>a(p("antikoshka",r.value))),t.addEventListener("change",()=>a(p("open",t.value))),a(o.type["Пластиковое окно"])}function I(){const o=document.querySelectorAll('input[name="choice"]');let e=document.getElementById("delivery-address");function r(){const t=document.querySelector('input[name="choice"]:checked')?.value;t==="1"||t==="2"?e.style.display="flex":e.style.display="none";const n=document.getElementById("fill-order");n?.classList.contains("active")&&(n.style.maxHeight=n.scrollHeight+"px")}o.forEach(t=>{t.addEventListener("change",r)}),r()}const O=document.querySelector("#brandmenu"),q=document.querySelector(".brandmenu-dropdown");O.addEventListener("click",()=>{q.classList.toggle("show")});const b=document.getElementById("calc-form"),N=async o=>{o.preventDefault();const e=document.getElementById("orderResult");e&&(e.innerHTML="");const r=new FormData(b),t=Object.fromEntries(r.entries());console.log(t);const n="https://dim.komax.com.ua/api/calc/moskitos";try{const s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){let d=`Помилка: ${s.status}`;try{const m=await s.json();m.error&&(d=m.error)}catch{d=await s.text()}throw new Error(d)}const c=await s.json();console.log("✅ Площа (square):",c.square),console.log("✅ Ціна (price):",c.price);const a=document.getElementById("price-result");a.textContent=c.price.toString();const p=document.getElementById("square-result");p.textContent=c.square.toString(),F(),S("calc-results-block"),t.price=c.price.toString(),t.square=c.square.toString();const i=t.city;["formData","moskitos_"+i,"moskitos_temp_"+i].forEach(d=>localStorage.removeItem(d)),localStorage.setItem("moskitos_temp_"+i,JSON.stringify(t)),typeof i=="string"&&localStorage.setItem("city",i),console.log("Сохранено в LocalStorage:",t)}catch(s){s instanceof Error?console.error("❌ Виникла проблема:",s.message):console.error("Невідома помилка:",s)}};b.addEventListener("submit",N);function C(){const o=localStorage.getItem("city");if(o){const e=localStorage.getItem("moskitos_temp_"+o);if(e){const r=JSON.parse(e),t=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");t.push(r),localStorage.setItem("moskitos_setki_kyiv",JSON.stringify(t)),console.log("Обновлённый массив объектов:",t),v(),localStorage.setItem("windows_lastAdded",Date.now().toString()),S("basket-block")}}}const D=document.getElementById("addBasket");D?.addEventListener("click",()=>C());const T=document.getElementById("open-fill-order");T?.addEventListener("click",()=>H());function H(){S("fill-order")}function S(o){const e=document.getElementById(o);e&&(e.classList.add("active"),e.style.maxHeight=e.scrollHeight+"px",window.addEventListener("resize",()=>{e.classList.contains("active")&&(e.style.maxHeight=e.scrollHeight+"px")}))}function B(){document.querySelectorAll(".active").forEach(e=>{e.style.maxHeight="0",e.classList.remove("active")})}function v(){const o=document.getElementById("list");if(!o)return;const e=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");if(e.length===0){B(),o.innerHTML="";return}o.innerHTML="",e.forEach((t,n)=>{const s=document.createElement("li");s.className="setka-in-basket-block",s.textContent=`${n+1}. ${t.antikoshka} на ${t.type}: ${t.width} x ${t.height} - ${t.color} = ${t.price} грн.`;const c=document.createElement("button");c.className="setka-item";const a=`
  <svg xmlns="http://www.w3.org/2000/svg" 
       fill="none" 
       viewBox="0 0 24 24" 
       stroke-width="1.5" 
       stroke="currentColor" 
       class="size-6"
       aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 L18 6 M6 6 L18 18"></path>
  </svg>
`;c.innerHTML=a,c.style.marginLeft="10px",c.addEventListener("click",()=>{A(n)}),s.appendChild(c),o.appendChild(s)});const r=localStorage.getItem("windows_lastAdded");if(r){const t=new Date(parseInt(r));console.log("Последнее добавление:",t.toLocaleString())}J()}function A(o){const e=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");e.splice(o,1),localStorage.setItem("moskitos_setki_kyiv",JSON.stringify(e)),v()}function J(){const o=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]"),e=document.getElementById("count"),r=document.getElementById("sumWidth"),t=o.length,n=o.reduce((s,c)=>s+Number(c.price||0),0);e&&(e.textContent=t.toString()),r&&(r.textContent=n.toString())}v();const h=document.getElementById("zakaz"),u=document.getElementById("orderResult");h.addEventListener("submit",async o=>{o.preventDefault();const e=new FormData(h),r=e.get("name")?.toString()||"",t=e.get("email")?.toString()||"",n=e.get("phone")?.toString()||"",s=e.get("address")?.toString()||"",a=h.querySelector('input[name="choice2"]:checked')?.value||"",i=h.querySelector('input[name="choice"]:checked')?.value||"",l=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]"),d=l[0]?.city,m=l.length,k=l.reduce((y,L)=>y+Number(L.width||0),0),g={name:r,email:t,phone:n,setki:l,quantity:m,total_cost:k,payment:a,delivery:i,city:d,address:s};try{const y=await fetch("https://dim.komax.com.ua/api/zakaz/moskitos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!y.ok)throw new Error("Ошибка отправки заказа");const E=(await y.json()).orderNumber;u&&(u.textContent=`Ваш номер заказа: ${E}`,h.reset(),localStorage.removeItem("moskitos_setki_kyiv"),I(),B(),requestAnimationFrame(()=>{setTimeout(()=>{if(u){const f=document.getElementById("orderLink");if(f){const w=new URL(f.href,window.location.origin);w.searchParams.set("current",E.toString()),f.href=w.toString()}M(),u.scrollIntoView({behavior:"smooth",block:"start"}),u.classList.add("highlight"),setTimeout(()=>u.classList.remove("highlight"),2e3)}},500)}))}catch(y){console.error(y),u&&(u.textContent="Произошла ошибка при отправке заказа.")}});document.addEventListener("DOMContentLoaded",()=>{_(x),I()});function M(){const o=document.querySelector(".show-current");o&&o.classList.add("active")}function F(){const o=document.querySelector(".show-current");o&&o.classList.remove("active")}
