(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();const E=document.querySelector("#brandmenu"),w=document.querySelector(".brandmenu-dropdown");E.addEventListener("click",()=>{w.classList.toggle("show")});const h=document.getElementById("calc-form"),b=async s=>{s.preventDefault();const e=new FormData(h),r=Object.fromEntries(e.entries());console.log(r);const n="https://dim.komax.com.ua/api/calc/moskitos";try{const t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok)throw new Error(`Помилка мережі: ${t.status}`);const o=await t.json();console.log("Дані успішно отримано:"),console.log("Площа (square):",o.square),console.log("Ціна (price):",o.price);const c=document.getElementById("price-result");c.textContent=o.price.toString();const f=document.getElementById("square-result");f.textContent=o.square.toString(),g("calc-results-block"),r.price=o.price.toString(),r.square=o.square.toString();const a=r.city;["formData","moskitos_"+a,"moskitos_temp_"+a].forEach(u=>localStorage.removeItem(u)),localStorage.setItem("moskitos_temp_"+a,JSON.stringify(r)),typeof a=="string"&&localStorage.setItem("city",a),console.log("Сохранено в LocalStorage:",r)}catch(t){t instanceof Error?console.error("Виникла проблема із запитом:",t.message):console.error("Невідома помилка:",t)}};h.addEventListener("submit",b);function _(){const s=localStorage.getItem("city");if(s){const e=localStorage.getItem("moskitos_temp_"+s);if(e){const r=JSON.parse(e),n=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");n.push(r),localStorage.setItem("moskitos_setki_kyiv",JSON.stringify(n)),console.log("Обновлённый массив объектов:",n),p(),localStorage.setItem("windows_lastAdded",Date.now().toString()),g("basket-block")}}}const L=document.getElementById("addBasket");L?.addEventListener("click",()=>_());const O=document.getElementById("open-fill-order");O?.addEventListener("click",()=>B());function B(){g("fill-order")}function g(s){const e=document.getElementById(s);e&&(e.classList.add("active"),e.style.maxHeight=e.scrollHeight+"px")}function k(){document.querySelectorAll(".active").forEach(e=>{e.style.maxHeight="0",e.classList.remove("active")})}function p(){const s=document.getElementById("list");if(!s)return;const e=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");if(e.length===0){k(),s.innerHTML="";return}s.innerHTML="",e.forEach((n,t)=>{const o=document.createElement("li");o.className="setka-in-basket-block",o.textContent=`${t+1}. ${n.antikoshka} на ${n.type}: ${n.width} x ${n.height} - ${n.color} = ${n.price} грн.`;const c=document.createElement("button");c.textContent="Удалить",c.style.marginLeft="10px",c.addEventListener("click",()=>{x(t)}),o.appendChild(c),s.appendChild(o)});const r=localStorage.getItem("windows_lastAdded");if(r){const n=new Date(parseInt(r));console.log("Последнее добавление:",n.toLocaleString())}N()}function x(s){const e=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");e.splice(s,1),localStorage.setItem("moskitos_setki_kyiv",JSON.stringify(e)),p()}function N(){const s=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]"),e=document.getElementById("count"),r=document.getElementById("sumWidth"),n=s.length,t=s.reduce((o,c)=>o+Number(c.price||0),0);e&&(e.textContent=n.toString()),r&&(r.textContent=t.toString())}p();const d=document.getElementById("zakaz"),i=document.getElementById("orderResult");d.addEventListener("submit",async s=>{s.preventDefault();const e=new FormData(d),r=e.get("name")?.toString()||"",n=e.get("email")?.toString()||"",t=e.get("phone")?.toString()||"",c=d.querySelector('input[name="choice2"]:checked')?.value||"",a=d.querySelector('input[name="choice"]:checked')?.value||"",m=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]"),u=m.length,S=m.reduce((l,y)=>l+Number(y.width||0),0),v={name:r,email:n,phone:t,windows:m,count:u,sumWidth:S,payment:c,delivery:a};try{const l=await fetch("https://dim.komax.com.ua/api/zakaz/moskitos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!l.ok)throw new Error("Ошибка отправки заказа");const I=(await l.json()).orderNumber;i&&(i.textContent=`Ваш номер заказа: ${I}`,d.reset(),localStorage.removeItem("moskitos_setki_kyiv"),k(),requestAnimationFrame(()=>{setTimeout(()=>{i&&(i.scrollIntoView({behavior:"smooth",block:"start"}),i.classList.add("highlight"),setTimeout(()=>i.classList.remove("highlight"),2e3))},500)}))}catch(l){console.error(l),i&&(i.textContent="Произошла ошибка при отправке заказа.")}});
