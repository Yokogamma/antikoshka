(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const E=document.querySelector("#brandmenu"),w=document.querySelector(".brandmenu-dropdown");E.addEventListener("click",()=>{w.classList.toggle("show")});const S=document.getElementById("calc-form"),b=async n=>{n.preventDefault();const t=new FormData(S),r=Object.fromEntries(t.entries());console.log(r);const s="https://dim.komax.com.ua/api/calc/moskitos";try{const e=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok)throw new Error(`Помилка мережі: ${e.status}`);const o=await e.json();console.log("Дані успішно отримано:"),console.log("Площа (square):",o.square),console.log("Ціна (price):",o.price);const c=document.getElementById("price-result");c.textContent=o.price.toString();const y=document.getElementById("square-result");y.textContent=o.square.toString(),f("calc-results-block");const l={};t.forEach((m,g)=>{l[g]=m.toString()});const i=l.city;["formData","moskitos_"+i,"moskitos_temp_"+i].forEach(m=>localStorage.removeItem(m)),localStorage.setItem("moskitos_temp_"+i,JSON.stringify(l)),typeof i=="string"&&localStorage.setItem("city",i),console.log("Сохранено в LocalStorage:",l)}catch(e){e instanceof Error?console.error("Виникла проблема із запитом:",e.message):console.error("Невідома помилка:",e)}};S.addEventListener("submit",b);function _(){const n=localStorage.getItem("city");if(n){const t=localStorage.getItem("moskitos_temp_"+n);if(t){const r=JSON.parse(t),s=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");s.push(r),localStorage.setItem("moskitos_setki_kyiv",JSON.stringify(s)),console.log("Обновлённый массив объектов:",s),p(),localStorage.setItem("windows_lastAdded",Date.now().toString()),f("basket-block")}}}const L=document.getElementById("addBasket");L?.addEventListener("click",()=>_());const O=document.getElementById("open-fill-order");O?.addEventListener("click",()=>B());function B(){f("fill-order")}function f(n){const t=document.getElementById(n);t&&(t.classList.add("active"),t.style.maxHeight=t.scrollHeight+"px")}function v(){document.querySelectorAll(".active").forEach(t=>{t.style.maxHeight="0",t.classList.remove("active")})}function p(){const n=document.getElementById("list");if(!n)return;const t=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");if(t.length===0){v(),n.innerHTML="";return}n.innerHTML="",t.forEach((s,e)=>{const o=document.createElement("li");o.className="setka-in-basket-block",o.textContent=`${e+1}. ${s.antikoshka} на ${s.type}: ${s.width} x ${s.height} - ${s.color} = 1680 грн.`;const c=document.createElement("button");c.textContent="Удалить",c.style.marginLeft="10px",c.addEventListener("click",()=>{N(e)}),o.appendChild(c),n.appendChild(o)});const r=localStorage.getItem("windows_lastAdded");if(r){const s=new Date(parseInt(r));console.log("Последнее добавление:",s.toLocaleString())}x()}function N(n){const t=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]");t.splice(n,1),localStorage.setItem("moskitos_setki_kyiv",JSON.stringify(t)),p()}function x(){const n=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]"),t=document.getElementById("count"),r=document.getElementById("sumWidth"),s=n.length,e=n.reduce((o,c)=>o+Number(c.width||0),0);t&&(t.textContent=s.toString()),r&&(r.textContent=e.toString())}p();const u=document.getElementById("zakaz"),a=document.getElementById("orderResult");u.addEventListener("submit",async n=>{n.preventDefault();const t=new FormData(u),r=t.get("name")?.toString()||"",s=t.get("email")?.toString()||"",e=t.get("phone")?.toString()||"",c=u.querySelector('input[name="choice2"]:checked')?.value||"",l=u.querySelector('input[name="choice"]:checked')?.value||"",i=JSON.parse(localStorage.getItem("moskitos_setki_kyiv")||"[]"),h=i.length,m=i.reduce((d,k)=>d+Number(k.width||0),0),g={name:r,email:s,phone:e,windows:i,count:h,sumWidth:m,payment:c,delivery:l};try{const d=await fetch("http://ava.test/api/zakaz/moskitos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!d.ok)throw new Error("Ошибка отправки заказа");const I=(await d.json()).orderNumber;a&&(a.textContent=`Ваш номер заказа: ${I}`,u.reset(),localStorage.removeItem("moskitos_setki_kyiv"),v(),requestAnimationFrame(()=>{setTimeout(()=>{a&&(a.scrollIntoView({behavior:"smooth",block:"start"}),a.classList.add("highlight"),setTimeout(()=>a.classList.remove("highlight"),2e3))},500)}))}catch(d){console.error(d),a&&(a.textContent="Произошла ошибка при отправке заказа.")}});
